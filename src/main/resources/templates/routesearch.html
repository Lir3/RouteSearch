<!DOCTYPE html>
<html>
<head>
  <title>経路探索</title>
  <link rel="stylesheet" href="css/routesearch1.css">
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBgyV7oQ2AFPWLorch-9n57oQQuck-dRU0&libraries=places"></script>
  
  <style>
    body {
      display: flex; 
      margin: 0; 
      height: 100vh; 
    }

    .left-panel {
      width: 25%; 
      background-color: #ffffff;
      padding: 20px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      overflow-y: auto;
    }

    #map {
      height: 100vh;
      width: 75%;
    }
  </style>
</head>
<body>
  <div class="left-panel">
    <h1>経路探索</h1>
    <div>
      出発地: <input id="start" type="text" placeholder="出発地を入力">
      目的地: <input id="end" type="text" placeholder="目的地を入力">
      移動方法:
      <select id="mode">
        <option value="DRIVING">車</option>
        <option value="BICYCLING">自転車</option>
        <option value="TRANSIT">公共交通機関</option>
        <option value="WALKING">徒歩</option>
      </select>
      <button onclick="calcRoute()">経路探索</button>
      <button onclick="moveToCompanyLogin()">Company Login</button>
    </div>
    <div id="routes"></div>
  </div>
  <div id="map"></div>

  <script>
    let map;
    let directionsService;
    let directionsRenderer;
    let startAutocomplete;
    let endAutocomplete;

    function initMap() {
      map = new google.maps.Map(document.getElementById('map'), {
        center: {lat: 35.6895, lng: 139.6917},
        zoom: 13
      });
      directionsService = new google.maps.DirectionsService();
      directionsRenderer = new google.maps.DirectionsRenderer();
      directionsRenderer.setMap(map);

      const options = {
        componentRestrictions: { country: 'jp' }
      };
      startAutocomplete = new google.maps.places.Autocomplete(document.getElementById('start'), options);
      endAutocomplete = new google.maps.places.Autocomplete(document.getElementById('end'), options);
    }

    function calcRoute() {
      const start = document.getElementById('start').value;
      const end = document.getElementById('end').value;
      const selectedMode = document.getElementById('mode').value;

      const request = {
        origin: start,
        destination: end,
        travelMode: selectedMode,
      };

      directionsService.route(request, function(response, status) {
        if (status === 'OK') {
          directionsRenderer.setDirections(response);
          displayRouteInfo(response);
        } else {
          alert('経路を計算できませんでした: ' + status);
        }
      });
    }

    function displayRouteInfo(response) {
      const route = response.routes[0].legs[0];
      const duration = route.duration.text;
      const distance = route.distance.text;

      const routesDiv = document.getElementById('routes');
      routesDiv.innerHTML = `
        <p>所要時間: ${duration}</p>
        <p>距離: ${distance}</p>
      `;
    }

    function moveToCompanyLogin() {
      window.location.href = 'companylogin';
    }

    window.onload = initMap;
  </script>
</body>
</html>